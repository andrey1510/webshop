__README__
==========

Данное приложение представляет собой онлайн-магазин с возможностями просмотра выбора и заказа товаров, просмотра 
статистики заказов, использованием баланса.

Использованный стек: Java SE 21, Spring Boot, Spring Security, Keycloak, WebFlux, r2dbc, Redis, REST, Gradle, Lombok, 
Thymeleaf, OpenAPI, H2, JUnit 5, Mockito.

Установка и запуск:
-----------------------------------

1) Склонируйте репозиторий.

2) Запустите контейнер **keycloak** из **docker-compose.yml**, который находится в директории ```webshop```.

3) Настройте сервер Keycloak - зайдите на http://localhost:8080/ (логин ```admin```, пароль```admin```, можно поменять в
   **docker-compose.yml**) и импортируйте клиента (во вкладке **Client** нажмите **Import client** и загрузите 
файл **webshop-client.json**, который находится в директории ```webshop```). Также можно создать нового клиента, но тогда 
 нужно будет скопировать **Client Secret** из **Credentials** и вставить его во все файлы ```application.yml```
 и ```application-docker.yml``` у сервисов **paymentservice** и **shopservice** вместо текущего **Client Secret**.

4) Запустите контейнер  **redis** из **docker-compose.yml**.

5) Запустите контейнеры с сервисами **paymentservice** и **shopservice** из **docker-compose.yml**. Или же запустите их 
 в IDE.


Функционал приложения:
------------------------------------------

**Авторизация на сайте**

Авторизоваться на сайте можно на витрине магазина (```http://localhost:8888/products```). Следующие функции 
доступны только авторизованным пользователям: страницы корзины и заказов, добаление / изменение / удаление товаров в 
корзине, оплата заказов. Каждый авторизованный пользователь может видеть только свою корзину и заказы. Также у каждого 
авторизованного пользователя свой баланс.

В сервис уже добавлено 2 пользователя для тестирования:
1) логин ```sample-user-1```, пароль ```password-1```
2) логин ```sample-user-2```, пароль ```password-2```
Пользователям добавлено по 1000 р. на баланс.

**Добавление товаров в магазин**

В сервис уже добавлено 2 продукта для тестирования. 
На странице ```http://localhost:8888/product-creator``` содержится форма для добавления продуктов в магазин. В форме 
нужно заполнить поля "Название товара", "Описание товара", "Цена товара", и, опционально, загрузить файл с изображением.
Изображение может быть формата ```.jpeg```, ```.jpg```, ```.png``` и размером не более 3 мегабайт.

После заполнения всей нужной информации, товар следует сохранить, нажав на кнопку ```Создать товар```. 
После успешного сохранения появится сообщение ```Товар успешно создан!``` (оно убирается нажатием крестика справа).

На витрину магазина с товарами можно перейти, нажав на кнопку "Перейти в магазин" справа сверху.

**Витрина магазина с товарами**

Витрина магазина со всеми товарами находится на странице ```http://localhost:8888/products```. У каждого товара 
имеется название, цена и изображение (опционально).

Витрина магазина доступна всем. Сверху страницы имеет форма с логином и паролем для авторизации на сайте. Для авторизованных 
пользователей также доступна кнопка выхода.

Товары можно фильтровать по названию (т.е. по вхождению комбинации символов в фильтре в название) или по цене 
(т.е. одномоментно либо по названию, либо по цене), и сортировать по алфавиту или цене (можно одновременно 
с фильтрацией). 

Авторизированные пользователи могут можно добавить товар в корзину кнопкой ```Добавить в корзину```, затем изменить количество кнопками ```+``` и ```-```, 
а также удалить из корзины кнопкой ```Удалить```.

Кнопки управления пагинацией находятся внизу страницы.

Авторизированные пользователи могут перейти в корзину и на страницу оформленных товаров с помощью кнопок справа сверху.

Все могут перейти на страницу конкретного товара, нажав на его название.

**Страница товара**

На странице товара ```http://localhost:8888/products/{id}``` имеется его название, описание, цена и 
изображение (опционально). 

Страница товара доступна всем.

Авторизированные пользователи могут добавить товар в корзину кнопкой ```Добавить в корзину```, затем изменить количество 
кнопками ```+``` и ```-```, а также удалить из корзины кнопкой ```Удалить```.

**Корзина**

Доступна только авторизированным пользователям. В корзине (```http://localhost:8888/cart```) находятся положенные в нее товары. В них имеется название, цена, 
количество, сумма всех экземпляров товара, а также сумма всего заказа в корзине. Также можно изменить количество
товара кнопками ```+``` и ```-```, и удалить товар из корзины кнопкой ```Удалить```.

Что оформить заказ, нужно нажать на кнопку ```Оформить заказ``` снизу. Тогда заказ в корзине перейдет в статус 
оформленного, а также произойдет перенаправление на страницу этого оформленного заказа. Нельзя оформить заказ, если 
корзина пустая (будет выдано соответствующее сообщение).

При оформлении заказа осуществляется автоматическая проверка баланса. Если сумма заказа в корзине превышает сумму 
баланса, то успешное оформление заказа будет невозможно. Кнопка ```Оформить заказ``` будет неактивна и будет выдано 
сообщение о недостаточном балансе.

После успешного оформления заказа его сумма будет вычтена из баланса.  

Можно перейти на витрину и на страницу оформленных товаров с помощью кнопок справа сверху. 

**Страница оформленного заказа**

Доступна только авторизированным пользователям. На странице оформленного заказа ```http://localhost:8888/orders/{id}``` имеется список товаров в нем (у каждого 
название, изображение (опционально), цена, количество, общая цена экземпляров товара); общая сумма заказа. Также 
имеется номер, и дата и время оформления заказа.

Можно перейти на витрину, в корзину и на страницу оформленных товаров с помощью кнопок справа сверху.

**Страница всех оформленных заказов**

Доступна только авторизированным пользователям. На странице всех оформленных заказов ```http://localhost:8888/orders``` имеется перечень всех оформленных заказов. 
У каждого есть номер, дата и время оформления, и сумма заказа. Также имеется общая сумма всех заказов.

На страницу конкретного оформленного заказа можно перейти, нажав на его название.

Можно перейти на витрину и в корзину с помощью кнопок справа сверху.

Тесты
------------------------------------------

К приложению прилагаются интеграционные и юнит тесты.